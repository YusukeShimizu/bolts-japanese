# BOLT #0: はじめにと索引

ようこそ、友よ！これらの Basis of Lightning Technology (BOLT) ドキュメントは、オフチェーンでのビットコイン転送のためのレイヤー2プロトコルを説明しています。必要に応じて、オンチェーンのトランザクションに依存して強制力を持たせます。

いくつかの要件は微妙です。ここで見られる結果の背後にある動機や理由を強調しようと努めました。私たちが不十分であることは承知しています。もし混乱したり間違っている部分を見つけたら、ぜひご連絡いただき、改善にご協力ください。

これはバージョン 0 です。

1. [BOLT #1](01-messaging.md): 基本プロトコル
2. [BOLT #2](02-peer-protocol.md): チャネル管理のためのピアプロトコル
3. [BOLT #3](03-transactions.md): ビットコイントランザクションとスクリプトフォーマット
4. [BOLT #4](04-onion-routing.md): オニオンルーティングプロトコル
5. [BOLT #5](05-onchain.md): オンチェーントランザクション処理の推奨事項
7. [BOLT #7](07-routing-gossip.md): P2Pノードとチャネルの発見
8. [BOLT #8](08-transport.md): 暗号化および認証されたトランスポート
9. [BOLT #9](09-features.md): 割り当てられた機能フラグ
10. [BOLT #10](10-dns-bootstrap.md): DNSブートストラップと支援されたノードの位置特定
11. [BOLT #11](11-payment-encoding.md): ライトニングペイメントのための請求書プロトコル

## スパーク：ライトニングの簡単な紹介

ライトニングは、ビットコインを使用して高速な支払いを行うためのプロトコルであり、チャネルのネットワークを利用します。

### チャネル

ライトニングは *チャネル* を確立することで機能します。2人の参加者が、ビットコインネットワーク上でロックされた一定量のビットコイン（例：0.1ビットコイン）を含むライトニングペイメントチャネルを作成します。これは両者の署名があって初めて使用可能です。

最初に、彼らはすべてのビットコイン（例：0.1ビットコイン）を一方の当事者に戻すビットコイントランザクションをそれぞれ保持します。後でこれらの資金を異なる割合で分割する新しいビットコイントランザクションに署名し、以前のビットコイントランザクションを無効にして使用されないようにすることができます。

チャネルの確立については [BOLT #2: Channel Establishment](02-peer-protocol.md#channel-establishment) を、チャネルを作成するビットコイントランザクションのフォーマットについては [BOLT #3: Funding Transaction Output](03-transactions.md#funding-transaction-output) を参照してください。参加者が意見を異にしたり失敗した場合に、クロスサインされたビットコイントランザクションを使用する必要がある場合の要件については [BOLT #5: Recommendations for On-chain Transaction Handling](05-onchain.md) を参照してください。

### 条件付き支払い

Lightning チャネルは 2 人の参加者間での支払いのみを許可しますが、チャネルを接続してネットワークを形成することで、ネットワーク内のすべてのメンバー間での支払いが可能になります。これには条件付き支払いの技術が必要です。例えば、「6 時間以内に秘密を明かせば 0.01 ビットコインを受け取ることができる」といった条件をチャネルに追加できます。受取人が秘密を提示すると、そのビットコイン取引は条件付き支払いを欠いたものに置き換えられ、受取人の出力に資金が追加されます。

参加者が条件付き支払いを追加するために使用するコマンドについては [BOLT #2: Adding an HTLC](02-peer-protocol.md#adding-an-htlc-update_add_htlc) を、ビットコイン取引の完全な形式については [BOLT #3: Commitment Transaction](03-transactions.md#commitment-transaction) を参照してください。

### 転送

このような条件付き支払いは、より短い時間制限で他の参加者に安全に転送できます。例えば、「5 時間以内に秘密を明かせば 0.01 ビットコインを受け取ることができる」といった具合です。これにより、仲介者を信頼することなく、チャネルをネットワークに連鎖させることができます。

支払いの転送に関する詳細は [BOLT #2: Forwarding HTLCs](02-peer-protocol.md#forwarding-htlcs) を、支払い指示がどのように輸送されるかについては [BOLT #4: Packet Structure](04-onion-routing.md#packet-structure) を参照してください。

### ネットワークトポロジー

支払いを行うには、参加者がどのチャネルを通じて送信できるかを知る必要があります。参加者はチャネルやノードの作成、および更新について互いに知らせます。

通信プロトコルの詳細については [BOLT #7: P2P Node and Channel Discovery](07-routing-gossip.md) を、初期ネットワークブートストラップについては [BOLT #10: DNS Bootstrap and Assisted Node Location](10-dns-bootstrap.md) を参照してください。

### 支払い請求書

参加者は、どの支払いを行うべきかを示す請求書を受け取ります。

支払いの宛先と目的を記述するプロトコルについては、後で支払いの成功を証明できるようにするために [BOLT #11: Invoice Protocol for Lightning Payments](11-payment-encoding.md) を参照してください。


## 用語集と用語ガイド

* #### *Announcement*:
   * *[peers](#peers)* 間で送信されるゴシップメッセージで、*[channel](#channel)* または *[node](#node)* の発見を支援することを目的としています。


* #### `chain_hash`:
   * 対象となるブロックチェーンを一意に識別するハッシュ（通常はジェネシスハッシュ）です。これにより、*ノード*が複数のブロックチェーン上で*チャネル*を作成し、参照することができます。ノードは、自分が知らない`chain_hash`を参照するメッセージを無視する必要があります。`bitcoin-cli`とは異なり、ハッシュは逆転されずに直接使用されます。

     メインチェーンのビットコインブロックチェーンの場合、`chain_hash`の値は次のようにする必要があります（16進数でエンコード）：
     `6fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000`。

* #### *チャネル*:
   * 2つの*ピア*間での迅速なオフチェーンの相互交換方法です。資金を取引するために、ピアは署名を交換して更新された*コミットメントトランザクション*を作成します。
   * _終了方法を参照： [相互クローズ](#mutual-close), [取り消されたトランザクションクローズ](#revoked-transaction-close), [一方的クローズ](#unilateral-close)_
   * _関連項目を参照： [ルート](#route)_

* #### *クローズトランザクション*:
   * *相互クローズ*の一部として生成されるトランザクションです。クローズトランザクションは_コミットメントトランザクション_に似ていますが、保留中の支払いはありません。
   * _関連項目を参照： [コミットメントトランザクション](#commitment-transaction), [資金調達トランザクション](#funding-transaction), [ペナルティトランザクション](#penalty-transaction)_

* #### *コミットメント番号*:
   * 各*コミットメントトランザクション*のための48ビットのインクリメントカウンターです。カウンターは*チャネル*内の各*ピア*に対して独立しており、0から始まります。
   * _コンテナを参照： [コミットメントトランザクション](#commitment-transaction)_
   * _関連項目を参照： [クローズトランザクション](#closing-transaction), [資金調達トランザクション](#funding-transaction), [ペナルティトランザクション](#penalty-transaction)_

* #### *コミットメント取り消し秘密鍵*:
   * 各*コミットメントトランザクション*には、他の*ピア*がすべての出力を即座に使用できるようにする一意のコミットメント取り消し秘密鍵の値があります。この鍵を公開することが、古いコミットメントトランザクションを取り消す方法です。取り消しをサポートするために、コミットメントトランザクションの各出力はコミットメント取り消し公開鍵を参照します。
   * _コンテナを参照： [コミットメントトランザクション](#commitment-transaction)_
   * _発信元を参照： [各コミットメントシークレット](#per-commitment-secret)_


* #### *コミットメントトランザクション*:
   * *[資金トランザクション](#funding-transaction)* を消費するトランザクションです。各 *ピア* はこのトランザクションのために相手ピアの署名を保持しているため、常に消費可能なコミットメントトランザクションを持っています。新しいコミットメントトランザクションが交渉されると、古いものは *無効化* されます。
   * _関連部分: [コミットメント番号](#commitment-number), [コミットメント無効化秘密鍵](#commitment-revocation-private-key), [HTLC](#HTLC-Hashed-Time-Locked-Contract), [各コミットメントの秘密](#per-commitment-secret), [アウトポイント](#outpoint)_
   * _関連項目: [クローズトランザクション](#closing-transaction), [資金トランザクション](#funding-transaction), [ペナルティトランザクション](#penalty-transaction)_
   * _関連タイプ: [無効化されたコミットメントトランザクション](#revoked-commitment-transaction)_

* #### *チャネルを失敗させる*:
  * これはチャネルの強制クローズです。非常に初期の段階（オープン前）では、チャネルの存在を忘れる以外の行動を必要としないかもしれません。通常は、最新のコミットメントトランザクションに署名してブロードキャストする必要がありますが、相互クローズの場合は、相互クローズトランザクションに署名してブロードキャストすることでも行えます。詳細は [BOLT #5](05-onchain.md#failing-a-channel) を参照してください。

* #### *接続をクローズする*:
  * これはピアとの通信をクローズすることを意味します（例えば、TCPソケットをクローズする）。これはピアとのチャネルをクローズすることを意味しませんが、チャネルとの接続に対する未コミット状態を破棄する原因となります。詳細は [BOLT #2](02-peer-protocol.md#message-retransmission) を参照してください。

* #### *最終ノード*:
   * *[オリジンノード](#origin-node)* からいくつかの *[ホップ](#hop)* を経由して支払いをルーティングするパケットの最終受信者です。また、チェーン内の最終 *[受信ピア](#receiving-peer)* でもあります。
   * _カテゴリ: [ノード](#node)_
   * _関連項目: [オリジンノード](#origin-node), [処理ノード](#processing-node)_

* #### *資金トランザクション*:
   * チャネル上の両方の *[ピア](#peers)* に支払う、不可逆のオンチェーントランザクションです。相互の同意によってのみ消費可能です。
   * _関連項目: [クローズトランザクション](#closing-transaction), [コミットメントトランザクション](#commitment-transaction), [ペナルティトランザクション](#penalty-transaction)_


* #### *Hop*:
   * *[ノード](#node)*。一般的には、* [起点ノード](#origin-node) * と * [終点ノード](#final-node) * の間に位置する中間ノードです。
   * _カテゴリ参照: [ノード](#node)_

* #### *HTLC*: ハッシュタイムロック契約。
   * 2つの *[ピア](#peers)* 間の条件付き支払いです。受取人はその署名と *支払いプレイメージ* を提示することで支払いを受け取ることができます。そうでなければ、支払人は指定された時間後に契約をキャンセルして支払いを取り消すことができます。これらは *[コミットメントトランザクション](#commitment-transaction)* の出力として実装されます。
   * _コンテナ参照: [コミットメントトランザクション](#commitment-transaction)_
   * _パーツ参照: [支払いハッシュ](#Payment-hash), [支払いプレイメージ](#Payment-preimage)_

* #### *Invoice*: Lightning Network上での資金要求であり、支払いタイプ、支払い金額、有効期限、その他の情報を含むことがあります。これは、Bitcoinスタイルのアドレスを使用するのではなく、Lightning Network上で支払いを行う方法です。

* #### *It's ok to be odd*:
   * 一部の数値フィールドに適用されるルールで、機能のオプションまたは必須サポートを示します。偶数は、両方のエンドポイントが該当する機能をサポートしなければならないことを示し、奇数は他のエンドポイントがその機能を無視してもよいことを示します。

* #### *MSAT*:
   * ミリサトシで、フィールド名としてよく使用されます。

* #### *Mutual close*:
   * *[チャネル](#channel)* の協力的なクローズで、各 *ピア* への出力を持つ *[資金トランザクション](#funding-transaction)* の無条件な支出をブロードキャストすることによって達成されます（ただし、1つの出力が小さすぎて含まれない場合を除く）。
   * _関連参照: [取り消されたトランザクションクローズ](#revoked-transaction-close), [一方的クローズ](#unilateral-close)_

* #### *Node*:
   * Lightningネットワークの一部であるコンピュータまたはその他のデバイスです。
   * _関連参照: [ピア](#peers)_
   * _タイプ参照: [終点ノード](#final-node), [ホップ](#hop), [起点ノード](#origin-node), [処理ノード](#processing-node), [受信ノード](#receiving-node), [送信ノード](#sending-node)_


* #### *オリジンノード*:
   * いくつかの [ホップ](#hop) を経由して支払いをルーティングするパケットを発信する *[ノード](#node)* です。これはチェーン内の最初の [送信ピア](#sending-peer) でもあります。
   * _カテゴリ参照: [ノード](#node)_
   * _関連参照: [ファイナルノード](#final-node), [プロセッシングノード](#processing-node)_

* #### *アウトポイント*:
  * 未使用のトランザクション出力を一意に識別するトランザクションハッシュと出力インデックスです。新しいトランザクションを作成するために、入力として必要です。
  * _関連参照: [資金調達トランザクション](#funding-transaction), [コミットメントトランザクション](#commitment-transaction)_

* #### *ペイメントハッシュ*:
   * *[HTLC](#HTLC-Hashed-Time-Locked-Contract)* はペイメントハッシュを含みます。これは *[ペイメントプリイメージ](#Payment-preimage)* のハッシュです。
   * _コンテナ参照: [HTLC](#HTLC-Hashed-Time-Locked-Contract)_
   * _オリジネータ参照: [ペイメントプリイメージ](#Payment-preimage)_

* #### *ペイメントプリイメージ*:
   * 支払いが受け取られたことを証明するもので、最終受取人が保持しています。この秘密を知っているのは最終受取人だけです。最終受取人は資金を解放するためにプリイメージを公開します。ペイメントプリイメージは *[HTLC](#HTLC-Hashed-Time-Locked-Contract)* 内で *[ペイメントハッシュ](#Payment-hash)* としてハッシュされます。
   * _コンテナ参照: [HTLC](#HTLC-Hashed-Time-Locked-Contract)_
   * _派生参照: [ペイメントハッシュ](#Payment-hash)_

* #### *ピア*:
   * お互いに通信している 2 つの *[ノード](#node)* です。
      * 2 つのピアは、チャネルを設定する前にお互いにゴシップすることがあります。
      * 2 つのピアは、取引を行うための *[チャネル](#channel)* を確立することがあります。
   * _関連参照: [ノード](#node)_

* #### *ペナルティトランザクション*:
   * *[取り消されたコミットメントトランザクション](#revoked-commitment-transaction)* のすべての出力を、*コミットメント取り消し秘密鍵* を使用して消費するトランザクションです。*[ピア](#peers)* は、他のピアが *[取り消されたコミットメントトランザクション](#revoked-commitment-transaction)* を放送して「不正行為」を試みた場合にこれを使用します。
   * _関連参照: [クローズトランザクション](#closing-transaction), [コミットメントトランザクション](#commitment-transaction), [資金調達トランザクション](#funding-transaction)_


* #### *コミットメントシークレット*：
   * 各* [コミットメントトランザクション](#commitment-transaction) *は、コミットメントシークレットから鍵を導出します。このシークレットは、すべての以前のコミットメントのための一連のコミットメントシークレットがコンパクトに保存できるように生成されます。
   * _コンテナを参照： [コミットメントトランザクション](#commitment-transaction)_
   * _導出を参照： [コミットメント取消秘密鍵](#commitment-revocation-private-key)_

* #### *処理ノード*：
   * * [起点ノード](#origin-node) *から始まり、* [最終ノード](#final-node) *に向かって支払いをルーティングするために送信されるパケットを処理している* [ノード](#node) *です。メッセージを受信するための* [受信ピア](#receiving-peer) *として機能し、その後パケットを送信するための[送信ピア](#sending-peer)として機能します。
   * _カテゴリを参照： [ノード](#node)_
   * _関連を参照： [最終ノード](#final-node), [起点ノード](#origin-node)_

* #### *受信ノード*：
   * メッセージを受信している* [ノード](#node) *です。
   * _カテゴリを参照： [ノード](#node)_
   * _関連を参照： [送信ノード](#sending-node)_

* #### *受信ピア*：
   * 直接接続された*ピア*からメッセージを受信している* [ノード](#node) *です。
   * _カテゴリを参照： [ピア](#Peers)_
   * _関連を参照： [送信ピア](#sending-peer)_

* #### *取消されたコミットメントトランザクション*：
   * 新しいコミットメントトランザクションが交渉されたために取消された古い* [コミットメントトランザクション](#commitment-transaction) *です。
   * _カテゴリを参照： [コミットメントトランザクション](#commitment-transaction)_

* #### *取消トランザクションクローズ*：
   * * [チャネル](#channel) *の無効なクローズで、*取消されたコミットメントトランザクション*をブロードキャストすることによって達成されます。もう一方の*ピア*は*コミットメント取消秘密鍵*を知っているため、* [ペナルティトランザクション](#penalty-transaction) *を作成できます。
   * _関連を参照： [相互クローズ](#mutual-close), [一方的クローズ](#unilateral-close)_

* #### *ルート*：
  * ライトニングネットワークを横断して、*起点ノード*から* [最終ノード](#final-node) *までの支払いを可能にする経路です。1つ以上の* [ホップ](#hop) *を経由します。
  * _関連を参照： [チャネル](#channel)_


* #### *送信ノード*:
   * メッセージを送信する *[ノード](#node)* です。
   * _カテゴリ参照: [ノード](#node)_
   * _関連参照: [受信ノード](#receiving-node)_

* #### *送信ピア*:
   * 直接接続された *ピア* にメッセージを送信する *[ノード](#node)* です。
   * _カテゴリ参照: [ピア](#Peers)_
   * _関連参照: [受信ピア](#receiving-peer)_

* #### *一方的クローズ*:
   * *[チャネル](#channel)* の非協力的なクローズで、*[コミットメントトランザクション](#commitment-transaction)* をブロードキャストすることで達成されます。このトランザクションは *[クローズトランザクション](#closing-transaction)* よりも大きく（つまり効率が悪く）、コミットメントをブロードキャストした *[ピア](#peers)* は、事前に交渉された期間、自分の出力にアクセスできません。
   * _関連参照: [相互クローズ](#mutual-close), [取り消されたトランザクションクローズ](#revoked-transaction-close)_

## テーマソング

      なぜこのネットワークは民主的になり得るのか...
      貨幣学的...
      暗号学的！
      なぜそれが Lightning としてリリースされるのか！
      (Lightning をリリースせよ！)


      タイムロックされた契約とハッシュ化された公開鍵を持つだろう、そうだ。
      (話し続けて、そうだ話し続けて)
      信頼のないスタートのために証人を分離するだろう、そうだ。
      (お金を手に入れる、絶対にお金を手に入れる)
      動的なオニオンルートで、彼らはブーツを震わせるだろう；
      それが真実だと知っている、屋根を突き抜けてスケーリングするだろう。
      Lightning をリリースせよ！
      (行け、行け、行け、行け；行け、行け、行け、行け、行け、行け)


      [コーラス:]
      ああリリースされた Lightning、それはデビットカードよりも優れている...
      (Lightning をリリースせよ、Lightning をリリースせよ！)
      リリースされた Lightning で、マイクロペイメントは簡単だ...
      (Lightning をリリースせよ、Lightning をリリースせよ！)
      そしてドカン：月に到達する -- Lightning をリリースせよ！
      (行け、行け、行け、行け；行け、行け、行け、行け、行け、行け)


      QRコードとスマートフォンアプリを持つだろう、そうだ。
      (オーオーオーオーオーオーオー)
      P2Pメッセージングと受動的収入を持つだろう、そうだ。
      (オーオーオーオーオーオーオー)
      アウトソースされたクローズウォッチが、私の股間に感覚を与える。
      リポジトリにタグが付くとき、それが自慢ではないとわかるだろう：
      リリースされた Lightning。



      [コーラス]
      [インストゥルメンタル, ~1m10s]
      [コーラス]
      (Lightning! Lightning! Lightning! Lightning!
       Lightning! Lightning! Lightning! Lightning!)


      さあ、みんな、仕事に取りかかろう！


   -- Anthony Towns <aj@erisian.com.au>

## 著者

[ FIXME: 著者リストを挿入 ]

![Creative Commons License](https://i.creativecommons.org/l/by/4.0/88x31.png "License CC-BY")
<br>
この作品は [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/) の下でライセンスされています。
